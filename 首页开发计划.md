# 妙笔小伙伴 - 首页开发计划

## 项目概述
基于视觉稿实现"妙笔小伙伴"智能英语作文批改应用的移动端首页，提供作文上传、学习资料浏览等核心功能。

## 技术栈
- **前端框架**: React 18 + TypeScript
- **构建工具**: Vite
- **样式方案**: Tailwind CSS + Styled Components
- **状态管理**: Zustand
- **路由管理**: React Router DOM
- **动画效果**: Framer Motion
- **图标库**: Lucide React
- **相机功能**: 浏览器原生 getUserMedia API
- **图片上传**: ImgBB 免费图片托管服务
- **AI批改服务**: 阿里云AI Studio API
- **数据持久化**: localStorage + Zustand persist
- **部署平台**: Netlify

## 页面结构设计

### 1. 整体布局
```
┌─────────────────────────┐
│         Header          │ ← 固定头部
├─────────────────────────┤
│                         │
│       Welcome Area      │ ← 欢迎区域
│                         │
├─────────────────────────┤
│     Upload Section      │ ← 上传区域
│                         │
├─────────────────────────┤
│  Learning Resources     │ ← 学习资料
│                         │
├─────────────────────────┤
│      Bottom Nav         │ ← 固定底部导航
└─────────────────────────┘
```

### 2. 组件架构
```
Home/
├── components/
│   ├── Header/
│   │   ├── Header.tsx
│   │   └── UserRoleSelector.tsx
│   ├── WelcomeSection/
│   │   ├── WelcomeSection.tsx
│   │   ├── UsageStats.tsx
│   │   └── FeatureHighlights.tsx
│   ├── UploadSection/
│   │   ├── UploadSection.tsx
│   │   ├── PhotoUploadCard.tsx
│   │   └── TextInputCard.tsx
│   ├── LearningResources/
│   │   ├── LearningResources.tsx
│   │   └── ResourceCard.tsx
│   └── BottomNavigation/
│       └── BottomNavigation.tsx
```

## 功能模块详细设计

### 1. Header 组件
**功能**: 应用标题、用户角色选择
**设计要点**:
- 左侧：应用标题 + 铅笔图标
- 右侧：用户角色选择（学生/其他）
- 高度：60px
- 背景：白色，带阴影

### 2. Welcome Section 组件
**功能**: 欢迎信息、使用统计、功能亮点
**设计要点**:
- 主标题：欢迎使用妙笔小伙伴
- 副标题：AI 助你写出好作文
- 插图：两个卡通儿童读书的插图
- 统计信息：
  - 今日剩余次数（5次）
  - 智能批改速度（3秒）
- 背景：白色渐变

### 3. Upload Section 组件
**功能**: 作文上传入口
**设计要点**:
- 标题：上传作文 + AI加持标签
- 两个上传卡片：
  - 拍照上传：支持手写体识别
  - 文本输入：支持复制粘贴
- 卡片设计：圆角、阴影、悬停效果

### 4. Learning Resources 组件
**功能**: 英语学习资料展示
**设计要点**:
- 标题：英语学习资料 + 查看全部
- 2x2网格布局：
  - 每日听力训练（蓝紫渐变）
  - 重点词汇记忆（绿色渐变）
  - 语法练习题库（紫色渐变）
  - 考试真题解析（橙色渐变）
- 每个卡片包含图标、标题、描述

### 5. Bottom Navigation 组件
**功能**: 底部导航栏
**设计要点**:
- 4个导航项：首页、作文、历史批改、优秀范文
- 当前页面高亮显示
- 固定底部，高度：60px

## 状态管理设计

### Store 结构
```typescript
interface AppState {
  // 用户信息
  user: {
    role: 'student' | 'teacher' | 'parent'
    remainingCount: number
    lastResetDate: string
  }
  
  // 学习资料
  learningResources: LearningResource[]
  
  // 上传历史
  uploadHistory: UploadRecord[]
  
  // 应用设置
  settings: {
    theme: 'light' | 'dark'
    language: 'zh' | 'en'
  }
}
```

### 数据持久化
- 用户信息：localStorage
- 上传历史：localStorage
- 学习资料：从API获取，缓存到sessionStorage

## 移动端优化策略

### 1. 响应式设计
- 主要针对手机端（375px - 414px）
- 使用rem单位，适配不同屏幕密度
- 触摸友好的按钮尺寸（最小44px）

### 2. 性能优化
- 图片懒加载
- 组件按需加载
- 防抖处理用户交互

### 3. 用户体验
- 流畅的滚动体验
- 防止iOS Safari橡皮筋效果
- 触摸反馈动画
- 加载状态提示

## ImgBB图片上传集成方案

### 服务选择
- **服务商**: ImgBB (https://imgbb.com)
- **免费额度**: 32MB/张，无总容量限制
- **优势**: 无需复杂配置，支持base64直接上传，返回公开URL

### 技术实现
```typescript
// 上传流程
1. 相机拍照 → base64数据
2. 调用ImgBB API → 上传图片
3. 获取公开URL → 用于AI解析
4. 保存到本地状态 → 历史记录
```

### 开发任务
- [ ] 注册ImgBB账号，获取API Key
- [ ] 创建图片上传服务模块
- [ ] 集成到相机组件
- [ ] 添加上传进度显示
- [ ] 实现错误处理和重试机制
- [ ] 集成AI批改API服务
- [ ] 实现批改结果解析和展示

### 代码实现示例
```typescript
// src/services/uploadService.ts
export const uploadImageToImgBB = async (base64Data: string): Promise<string> => {
  const formData = new FormData()
  formData.append('image', base64Data)
  formData.append('key', IMGBB_API_KEY)
  
  const response = await fetch('https://api.imgbb.com/1/upload', {
    method: 'POST',
    body: formData
  })
  
  const result = await response.json()
  if (result.success) {
    return result.data.url
  } else {
    throw new Error('上传失败')
  }
}
```

### 集成到相机组件
```typescript
// 在CameraModal.tsx中
const handlePhotoCapture = async (imageData: string) => {
  try {
    setUploading(true)
    const publicUrl = await uploadImageToImgBB(imageData)
    
    addUploadRecord({
      type: 'photo',
      content: publicUrl, // 存储公开URL
      status: 'completed'
    })
    
    showToast('照片上传成功！', 'success')
  } catch (error) {
    showToast('上传失败，请重试', 'error')
  } finally {
    setUploading(false)
  }
}
```

## AI批改服务集成方案

### 服务配置
- **API地址**: https://aistudio.alibaba-inc.com/api/aiapp/run/dBLyUMmRPox/latest
- **请求方式**: POST
- **认证方式**: X-AK Header (cb7a887f0c5be95aeb08148b358d8fc1)
- **功能**: 英语作文智能批改

### 技术实现
```typescript
// 批改流程
图片上传成功 → 调用AI批改API → 解析批改结果 → 展示给用户
```

### API参数说明
```typescript
interface AIRequest {
  empId: string          // 工号，固定 "222877"
  question: string       // 问题，固定 "test"
  sessionId: string      // 会话ID，使用UUID
  stream: boolean        // 固定 false
  returnRunLog: boolean  // 固定 false
  variableMap: {
    img: Array<{content: string}>  // 图片URL数组
    grade: {value: string}         // 年级信息
  }
}
```

### 批改结果解析
```typescript
interface CorrectionResult {
  polish: {
    origin: {title: string, content: string}
    polish: {title: string, content: string}
  }
  higglights: {
    highlights: string[]
  }
  corrects: {
    origin: {title: string, content: string}
    corrected: {title: string, content: string}
    proof: string
  }
  score: {
    language: number
    structure: number
    content: number
    creativity: number
    comment: string
  }
  statistic: {
    wordCount: number
    relevance: string
  }
}
```

### 开发任务
- [ ] 创建AI批改服务模块
- [ ] 实现API请求和响应处理
- [ ] 解析批改结果JSON数据
- [ ] 集成到上传流程中
- [ ] 创建批改结果展示组件
- [ ] 添加批改状态管理
- [ ] 配置Netlify部署环境
- [ ] 设置环境变量和API代理

### 代码实现示例
```typescript
// src/services/aiCorrectionService.ts
export const submitForCorrection = async (
  imageUrl: string, 
  grade: string
): Promise<CorrectionResult> => {
  const sessionId = generateUUID()
  
  const requestData = {
    empId: "222877",
    question: "test",
    sessionId,
    stream: false,
    returnRunLog: false,
    variableMap: {
      img: [{ content: imageUrl }],
      grade: { value: grade }
    }
  }

  const response = await fetch(AI_API_URL, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-AK': 'cb7a887f0c5be95aeb08148b358d8fc1'
    },
    body: JSON.stringify(requestData)
  })

  const result = await response.json()
  
  if (result.success && result.data?.content) {
    return JSON.parse(result.data.content)
  } else {
    throw new Error('AI批改失败')
  }
}
```

### 批改结果展示组件设计
```typescript
// src/components/CorrectionResult/CorrectionResult.tsx
interface CorrectionResultProps {
  result: CorrectionResult
  onClose: () => void
}

// 组件功能：
// 1. 一键润色对比展示
// 2. 亮点挖掘列表
// 3. 基础批改对比
// 4. 综合评分雷达图
// 5. 数据统计信息
// 6. 导出和分享功能
```

## 开发阶段规划

### Phase 1: 基础架构 (1-2天)
- [ ] 安装必要依赖包
- [ ] 设置Zustand状态管理
- [ ] 创建基础布局组件
- [ ] 实现移动端适配

### Phase 2: 核心组件 (2-3天)
- [ ] 实现Header组件
- [ ] 实现Welcome Section
- [ ] 实现Upload Section
- [ ] 实现Learning Resources

### Phase 3: 功能集成 (1-2天)
- [ ] 集成相机功能
- [ ] 集成ImgBB图片上传服务
- [ ] 集成AI批改API服务
- [ ] 实现数据持久化
- [ ] 添加动画效果
- [ ] 优化移动端体验
- [ ] 配置Netlify部署
- [ ] 测试生产环境API调用

### Phase 4: 测试优化 (1天)
- [ ] 功能测试
- [ ] 性能优化
- [ ] 兼容性测试
- [ ] 代码重构

## 技术难点与解决方案

### 1. 相机功能集成
**难点**: 浏览器兼容性、权限处理
**解决方案**: 
- 使用getUserMedia API
- 添加权限检查和错误处理
- 提供降级方案（文件上传）

### 2. 图片上传服务
**难点**: 图片存储和公开访问
**解决方案**: 
- 使用ImgBB免费图片托管服务
- 支持base64直接上传
- 获取公开URL用于AI解析
- 添加上传进度和错误处理

### 3. AI批改服务集成
**难点**: API调用、结果解析、状态管理
**解决方案**: 
- 封装AI批改API服务模块
- 实现完整的请求/响应处理
- 解析复杂的JSON结果数据
- 添加批改状态和进度管理

### 4. 移动端滚动优化
**难点**: iOS Safari滚动卡顿
**解决方案**:
- 使用-webkit-overflow-scrolling: touch
- 避免在滚动容器上使用transform
- 合理使用will-change属性

### 5. 状态管理复杂度
**难点**: 多组件状态同步
**解决方案**:
- 使用Zustand的模块化设计
- 合理划分store边界
- 使用中间件处理副作用

### 6. Netlify部署优化
**难点**: 生产环境API调用、构建优化、CDN配置
**解决方案**:
- 配置netlify.toml优化构建和路由
- 使用环境变量管理API密钥
- 配置API代理避免CORS问题
- 优化静态资源缓存策略

## 验收标准

### 功能验收
- [ ] 所有UI组件按视觉稿实现
- [ ] 相机拍照功能正常工作
- [ ] 图片上传到ImgBB功能正常
- [ ] AI批改API调用正常
- [ ] 批改结果解析和展示正确
- [ ] 数据持久化功能正常
- [ ] 移动端交互流畅
- [ ] Netlify部署成功且可访问
- [ ] 生产环境API调用正常

### 性能验收
- [ ] 首屏加载时间 < 2s
- [ ] 页面滚动帧率 > 55fps
- [ ] 内存使用合理

### 兼容性验收
- [ ] iOS Safari 14+
- [ ] Android Chrome 80+
- [ ] 微信内置浏览器

## 后续扩展计划

### 短期 (1-2周)
- 作文批改结果页面
- 批改结果详细展示组件
- 历史记录管理
- 用户设置页面
- 图片上传进度优化
- 批量上传功能

### 中期 (1个月)
- 学习资料详情页
- 用户成长档案
- 社交分享功能
- 图片压缩和格式优化
- 多图片上传支持
- 批改结果导出功能
- 批改历史统计分析

### 长期 (3个月)
- AI批改算法优化
- 多语言支持
- 离线功能支持
- 自建图片存储服务
- 图片AI识别优化
- 个性化批改建议
- 批改结果可视化分析

## Netlify部署配置方案

### 部署优势
- **速度更快**: 国内访问稳定，CDN全球分布
- **免费额度大**: 100GB带宽/月，300分钟构建时间/月
- **配置简单**: 支持自动部署，无需复杂配置
- **API支持**: 完全支持HTTP请求和外部API调用

### 配置文件
```toml
# netlify.toml
[build]
  publish = "dist"
  command = "npm run build"

[build.environment]
  NODE_VERSION = "20"

# SPA路由支持
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# API代理（可选）
[[redirects]]
  from = "/api/*"
  to = "https://aistudio.alibaba-inc.com/api/:splat"
  status = 200
  headers = { X-From = "Netlify" }

# 安全头设置
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
```

### 部署步骤
1. **推送代码到GitHub**
2. **连接Netlify**:
   - 访问 netlify.com
   - 点击 "New site from Git"
   - 选择 GitHub 仓库
   - 构建命令: `npm run build`
   - 发布目录: `dist`
3. **设置环境变量** (如需要):
   - Site settings → Environment variables
   - 添加 API 密钥等敏感信息

### 环境变量配置
```bash
# 在Netlify控制台设置
VITE_IMGBB_API_KEY=your_imgbb_api_key
VITE_AI_API_KEY=your_ai_api_key
VITE_AI_API_URL=https://aistudio.alibaba-inc.com/api/aiapp/run/dBLyUMmRPox/latest
```

### 性能优化
- **CDN加速**: 全球CDN节点，提升访问速度
- **缓存策略**: 静态资源长期缓存，API请求实时更新
- **压缩优化**: 自动Gzip压缩，减少传输大小
- **HTTP/2**: 支持HTTP/2协议，提升并发性能

---

**文档版本**: v1.1  
**创建时间**: 2024年12月  
**最后更新**: 2024年12月 (添加Netlify部署方案)
